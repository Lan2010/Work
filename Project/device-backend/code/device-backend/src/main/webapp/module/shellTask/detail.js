define(["jquery","Global","Menu","Grid"],function(s,r,t,a){"use strict";var o,d,i={},l=function(){var a=s("#devTable"),t="/api/shell/devDetailByTask";a.grid({url:r.path+t,data:{taskId:i.id},pageSize:10,columns:[{data:"orderNo",class:"td-sn",render:function(a,e,t,n){return n.pageSize*(n.page-1)+t}},{data:"number"},{data:"model"},{data:"onlineStatus",class:"txt-c",render:function(a,e,t){return null==a?'<span class="font-thingray">--</span>':'<i class="fa fa-wifi '+(a?"font-green":"font-thingray")+'" title="'+(a?"在线":"离线")+'"></i>'}},{data:"status",render:function(a,e,t){var n="";switch(a){case 0:n="成功";break;case 1:n="未发现下载资源的url";break;case 2:n="下载资源失败";break;case 3:n="资源MD5值校验不正确";break;case 4:n="安装插件失败"}return'<span class="'+(0==a?"font-green":"font-red")+'">'+n+"</span>"}}],onSuccess:function(a,e){r.checkJson(e)},onError:function(a,e){s("body").msg("error",{text:t+" - "+a.status+" - "+a.statusText+" - "+e})}})};return{onSearch:function(a,e){},onLoad:function(a,e){t.active("shellTask/list"),r.$page.addClass("page-gray"),i=e,o=s("#detlBody"),d=s("#formDetl"),function(n){if(i.id){o.loading();var t="/api/shell/taskDetailById";s.ajax({url:r.path+t,data:{taskId:i.id},cache:!1,success:function(a){if(r.checkJson(a)){var e=a.data,t=parseInt(e.completedNum/e.devTotal*100);d.fillForm(e,{fields:["taskName","user_name",{addTime:e.addTime?s.date(e.addTime).string:""},"shellName","taskDesc",{status:1==e.status?"已完成":"已发起"},{devTotal:'<span class="'+(100<=t?"font-green":"font-orange")+' font-16">'+t+"%</span>　（已完成："+e.completedNum+" / 总数："+e.devTotal+"）"}]}),s("#divAppend").toggleClass("hide",1==e.operateType),l(),n&&n(e),o.loading(!1)}},error:function(a,e){o.loading(!1),r.pageError(t+" - "+a.status+" - "+a.statusText+" - "+e)}})}}()}}});