define(["jquery","Global","Menu","Route","TSearch","Grid","DTP","Modal"],function(i,o,d,s,c,t,a,e){"use strict";var u,l=!0,f=function(){var t=i(this).data("id");if(t&&confirm("确定删除吗？")){o.$page.msg("loading",{text:"删除中"});var e="/api/firmware/delete";i.ajax({url:o.path+e,data:{firmwareId:t},cache:!1,success:function(t){o.checkJson(t)&&(o.$page.msg("success",{text:"删除成功",time:2e3}),u.refresh())},error:function(t,a){o.$page.msg("error",{text:e+" - "+t.status+" - "+t.statusText+" - "+a})}})}};return{refresh:function(){u.refresh()},onSearch:function(t,a){l=!1,c.fillData(a),u.load(a||{})},onLoad:function(t,a){var e,n,r;d.active(t),e=a,n=i("#mainTable"),r="/api/firmware/list",u=n.grid({url:o.path+r,data:e,columns:[{data:"orderNo",class:"td-sn",render:function(t,a,e,n){return n.pageSize*(n.page-1)+e}},{data:"nickName"},{data:"version"},{data:"model"},{data:"firmwareDesc"},{data:"addTime",render:function(t,a,e){return i.date(t).string}},{data:"user_name"},{data:"status",render:function(t,a,e){return t?'<span class="font-green">正常</span>':'<span class="font-gray">失效</span>'}},{data:"opt",class:"txt-c",render:function(t,a,e){return['<button type="button" class="btn default btn-del" data-id="'+a.firmwareId+'">删除</button>'].join("")}}],onSuccess:function(t,a){o.checkJson(a)&&(l&&s.updateHash(t),l=!0)},onError:function(t,a){i("body").msg("error",{text:r+" - "+t.status+" - "+t.statusText+" - "+a})}}),n.on("click",".btn-del",f),function(){i("#addTime").datetimepicker({format:"yyyy-mm-dd",minView:2});i("#model").setSelect({url:o.path+"/api/device/modelList",id:"code",name:"name"})}(),c.fillData(a),c.init({onSearch:function(t){u.load(t||{})},onFilter:function(t){u.load(t||{})},onClear:function(t){u.load(t||{})},onFiltClear:function(t){u.load(t||{})}})}}});