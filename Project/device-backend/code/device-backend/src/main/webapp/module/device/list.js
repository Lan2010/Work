define(["jquery","Global","Menu","Route","TSearch","Grid","DTP","Modal"],function(o,c,r,s,d,t,n,e){"use strict";var u,l,f="",h=function(t){for(var n=t.length,e=[],a=0,i=0;i<n;i++)e.push(t[i].number),t[i].onlineStatus||a++;f=e,l.toggleClass("dim",!(n&&!a))},g=function(){if(!o(this).hasClass("dim")&&f.length&&confirm("确定重启所选的设备吗？")){c.$page.msg("loading",{text:"重启命令提交中"});var e="/api/device/reboot";o.ajax({url:c.path+e,data:{reboot:1,dev_num:f.join(",")},cache:!1,success:function(t){c.checkJson(t)&&(c.$page.msg("success",{text:"操作成功",time:2e3}),u.refresh())},error:function(t,n){c.$page.msg("error",{text:e+" - "+t.status+" - "+t.statusText+" - "+n})},complete:function(){l.addClass("dim")}})}},m=function(){var t=o(this).data("id");if(t&&confirm("确定删除所选的设备吗？")){c.$page.msg("loading",{text:"删除中"});var e="/api/device/deleteDevice";o.ajax({url:c.path+e,data:{id:t},cache:!1,success:function(t){c.checkJson(t)&&(c.$page.msg("success",{text:"删除成功",time:2e3}),u.refresh())},error:function(t,n){c.$page.msg("error",{text:e+" - "+t.status+" - "+t.statusText+" - "+n})}})}};return{onSearch:function(t,n){!1,d.fillData(n),u.load(n||{})},onLoad:function(t,n){var e,a,i;r.active(t),l=o("#btnReboot"),e=n,a=o("#mainTable"),i="/api/device/list",u=a.grid({url:c.path+i,data:e,checkbox:!0,checkboxField:"number",columns:[{data:"orderNo",class:"td-sn",render:function(t,n,e,a){return a.pageSize*(a.page-1)+e}},{data:"number",render:function(t,n){return'<a href="#device/detail?id='+n.id+'" class="font-mac">'+t+"</a>"}},{data:"model"},{data:"bind",render:function(t,n,e){return n.bindAccount?'<span title="绑定时间：'+o.date(n.bindTime).ymd+'">'+n.bindAccount+"</span>":"未绑定"}},{data:"onlineStatus",class:"txt-c",render:function(t,n,e){return null==t?'<span class="font-thingray">--</span>':'<i class="fa fa-wifi '+(t?"font-green":"font-thingray")+'" title="'+(t?"在线":"离线")+'"></i>'}},{data:"millisecond",render:function(t,n,e){return t?'<span title="'+(n.onlineStatus?"在线时长":"离线时长")+'">'+o.convertMS(t)+"</span>":""}},{data:"isOnlined",class:"txt-c",render:function(t,n,e){return t?"是":"否"}},{data:"belongUnitId",render:function(t,n,e){return(1===t?"天智星":0===t&&"未知")||""}},{data:"opt",class:"txt-c",render:function(t,n,e){return['<button type="button" class="btn default btn-del" '+(n.isOnlined||n.onlineStatus||n.bindAccount?'disabled title="已绑定、在线、上过线的设备不允许删除"':'data-id="'+n.id+'"')+" >删除</button>"].join("")}}],onCheck:function(t){h(t.checked)},onSuccess:function(t,n){c.checkJson(n)&&s.updateHash(t)},onError:function(t,n){o("body").msg("error",{text:i+" - "+t.status+" - "+t.statusText+" - "+n})}}),a.on("click",".btn-del",m),l.on("click",g),d.fillData(n),d.init({onSearch:function(t){u.load(t||{})},onFilter:function(t){u.load(t||{})},onClear:function(t){u.load(t||{})},onFiltClear:function(t){u.load(t||{})}})}}});