define(["jquery","Global","Menu","Route","TSearch","Grid","DTP","Modal"],function(r,u,o,c,i,t,a,d){"use strict";var l,f=!0,p=function(){var t=r(this).data(),a=t.username,e=t.status;if(confirm("确定"+("1"==e?"禁用":"启用")+"该用户吗？")){u.$page.msg("loading",{text:"提交中"});var n="/api/user/disable";r.ajax({url:u.path+n,data:{user_name:a,status:e?0:1},cache:!1,success:function(t){u.checkJson(t)&&(u.$page.msg("success",{text:"操作成功",time:2e3}),l.refresh())},error:function(t,a){u.$page.msg("error",{text:n+" - "+t.status+" - "+t.statusText+" - "+a})}})}};return{tableRefresh:function(){l.refresh()},onSearch:function(t,a){f=!1,i.fillData(a),l.load(a||{})},onLoad:function(t,a){var e,n,s;o.active(t),e=a,n=r("#mainTable"),s="/api/user/list",l=n.grid({url:u.path+s,data:e,columns:[{data:"orderNo",class:"td-sn",render:function(t,a,e,n){return n.pageSize*(n.page-1)+e}},{data:"user_name"},{data:"nickname"},{data:"cell_phone"},{data:"addTime",render:function(t,a,e){return r.date(t).string}},{data:"role_id",render:function(t,a,e){return(0==t?"管理员":1==t&&"普通用户")||""}},{data:"status",render:function(t,a,e){return t?'<span class="font-green">启用</span>':'<span class="font-red">禁用</span>'}},{data:"opt",class:"txt-c",render:function(t,a,e){return['<button type="button" class="btn default btn-status" data-status="'+a.status+'" data-username="'+a.user_name+'">'+(a.status?"禁用":"启用")+"</button>　",'<button type="button" class="btn default btn-pass" data-status="'+a.status+'" data-username="'+a.user_name+'" data-id="'+a.user_id+'">修改密码</button>'].join("")}}],onSuccess:function(t,a){u.checkJson(a)&&(f&&c.updateHash(t),f=!0)},onError:function(t,a){r("body").msg("error",{text:s+" - "+t.status+" - "+t.statusText+" - "+a})}}),n.on("click",".btn-status",p),n.on("click",".btn-pass",function(){d.show({width:600,title:"修改密码",path:"user/userPass",data:r(this).data()})}),i.fillData(a),i.init({onSearch:function(t){l.load(t||{})},onClear:function(t){l.load(t||{})}})}}});