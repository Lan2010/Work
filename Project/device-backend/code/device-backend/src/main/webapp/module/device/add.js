define(["jquery","Global","Menu","Validate","DTP"],function(n,d,t,e,a){"use strict";var o,r,s,c,p=1,i=function(){var e,a,t,i;e="/api/device/modelList",n("#model").setSelect({url:d.path+e,id:"code",name:"name"}),n("#model2").setSelect({url:d.path+e,id:"code",name:"name"}),r.find("div.fileupload").fileupload(),a=n("#addType"),t=n("#divType1"),i=n("#divType2"),a.on("change","input",function(){var e=n(this).val();p=e,t.removeClass("hide"),i.removeClass("hide"),1==e&&i.addClass("hide"),2==e&&t.addClass("hide")}),s=o.validate({rules:{pn_appsecret:{regExp:""}},messages:{pn_appsecret:{regExp:""}}}),c=r.validate(),n("#productTtime").datetimepicker({format:"yyyy-mm-dd",endDate:n.date(new Date).ymd,minView:2}),n("#btnSubmit").on("click",function(){if((1!=p||s.form())&&(2!=p||c.form())){d.$page.msg("loading",{text:"添加中"});var t=2==p?"/api/device/importDevice":"/api/device/addDevice",e=2==p?new FormData(r.get(0)):o.serialize();n.ajax({url:d.path+t,type:"post",data:e,processData:2!=p,contentType:2!=p&&"application/x-www-form-urlencoded",dataType:"json",success:function(e){d.checkJson(e)&&(d.$page.msg("success",{text:"添加成功",time:2e3}),window.history.back())},error:function(e,a){d.$page.msg("error",{text:t+" - "+e.status+" - "+e.statusText+" - "+a})}})}}),o.on("submit",function(){return!1}),r.on("submit",function(){return!1})};return{onSearch:function(e,a){},onLoad:function(e,a){t.active("device/list"),d.$page.addClass("page-gray"),o=n("#formAdd"),r=n("#formImport"),i()}}});