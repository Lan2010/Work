KindEditor.plugin("media",function(p){var c=this,g="media",h=c.lang(g+"."),m=p.undef(c.allowMediaUpload,!0),v=p.undef(c.allowFileManager,!1),f=p.undef(c.formatUploadUrl,!0),k=p.undef(c.extraFileUploadParams,{}),b=p.undef(c.filePostName,"imgFile"),w=p.undef(c.uploadJson,c.basePath+"php/upload_json.php");c.plugin.media={edit:function(){var e=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+h.url+"</label>",'<input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+h.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+h.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:60px;">'+h.width+"</label>",'<input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="550" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keHeight" style="width:60px;">'+h.height+"</label>",'<input type="text" id="keHeight" class="ke-input-text ke-input-number" name="height" value="400" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keAutostart">'+h.autostart+"</label>",'<input type="checkbox" id="keAutostart" name="autostart" value="" /> ',"</div>","</div>"].join(""),a=c.createDialog({name:g,width:450,height:230,title:c.lang(g),body:e,yesBtn:{name:c.lang("yes"),click:function(e){var t=p.trim(n.val()),a=d.val(),i=o.val();if("http://"==t||p.invalidUrl(t))return alert(c.lang("invalidUrl")),void n[0].focus();if(!/^\d*$/.test(a))return alert(c.lang("invalidWidth")),void d[0].focus();if(!/^\d*$/.test(i))return alert(c.lang("invalidHeight")),void o[0].focus();var l=p.mediaImg(c.themesPath+"common/blank.gif",{src:t,type:p.mediaType(t),width:a,height:i,autostart:r[0].checked?"true":"false",loop:"true"});c.insertHtml(l).hideDialog().focus()}}}),i=a.div,n=p('[name="url"]',i),t=p('[name="viewServer"]',i),d=p('[name="width"]',i),o=p('[name="height"]',i),r=p('[name="autostart"]',i);if(n.val("http://"),m){var l=p.uploadbutton({button:p(".ke-upload-button",i)[0],fieldName:b,extraParams:k,url:p.addParam(w,"dir=media"),afterUpload:function(e){if(a.hideLoading(),0===e.error){var t=e.url;f&&(t=p.formatUrl(t,"absolute")),n.val(t),c.afterUpload&&c.afterUpload.call(c,t,e,g),alert(c.lang("uploadSuccess"))}else alert(e.message)},afterError:function(e){a.hideLoading(),c.errorDialog(e)}});l.fileBox.change(function(e){a.showLoading(c.lang("uploadLoading")),l.submit()})}else p(".ke-upload-button",i).hide();v?t.click(function(e){c.loadPlugin("filemanager",function(){c.plugin.filemanagerDialog({viewType:"LIST",dirName:"media",clickFn:function(e,t){1<c.dialogs.length&&(p('[name="url"]',i).val(e),c.afterSelectFile&&c.afterSelectFile.call(c,e),c.hideDialog())}})})}):t.hide();var u=c.plugin.getSelectedMedia();if(u){var s=p.mediaAttrs(u.attr("data-ke-tag"));n.val(s.src),d.val(p.removeUnit(u.css("width"))||s.width||0),o.val(p.removeUnit(u.css("height"))||s.height||0),r[0].checked="true"===s.autostart}n[0].focus(),n[0].select()},delete:function(){c.plugin.getSelectedMedia().remove(),c.addBookmark()}},c.clickToolbar(g,c.plugin.media.edit)});