KindEditor.plugin("insertfile",function(f){var c=this,p="insertfile",g=f.undef(c.allowFileUpload,!0),v=f.undef(c.allowFileManager,!1),m=f.undef(c.formatUploadUrl,!0),k=f.undef(c.uploadJson,c.basePath+"php/upload_json.php"),b=f.undef(c.extraFileUploadParams,{}),h=f.undef(c.filePostName,"imgFile"),w=c.lang(p+".");c.plugin.fileDialog=function(e){var l=f.undef(e.fileUrl,"http://"),a=f.undef(e.fileTitle,""),i=e.clickFn,t=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+w.url+"</label>",'<input type="text" id="keUrl" name="url" class="ke-input-text" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+w.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+w.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keTitle" style="width:60px;">'+w.title+"</label>",'<input type="text" id="keTitle" class="ke-input-text" name="title" value="" style="width:160px;" /></div>',"</div>","</form>","</div>"].join(""),n=c.createDialog({name:p,width:450,title:c.lang(p),body:t,yesBtn:{name:c.lang("yes"),click:function(e){var l=f.trim(r.val()),a=d.val();if("http://"==l||f.invalidUrl(l))return alert(c.lang("invalidUrl")),void r[0].focus();""===f.trim(a)&&(a=l),i.call(c,l,a)}}}),o=n.div,r=f('[name="url"]',o),u=f('[name="viewServer"]',o),d=f('[name="title"]',o);if(g){var s=f.uploadbutton({button:f(".ke-upload-button",o)[0],fieldName:h,url:f.addParam(k,"dir=file"),extraParams:b,afterUpload:function(e){if(n.hideLoading(),0===e.error){var l=e.url;m&&(l=f.formatUrl(l,"absolute")),r.val(l),c.afterUpload&&c.afterUpload.call(c,l,e,p),alert(c.lang("uploadSuccess"))}else alert(e.message)},afterError:function(e){n.hideLoading(),c.errorDialog(e)}});s.fileBox.change(function(e){n.showLoading(c.lang("uploadLoading")),s.submit()})}else f(".ke-upload-button",o).hide();v?u.click(function(e){c.loadPlugin("filemanager",function(){c.plugin.filemanagerDialog({viewType:"LIST",dirName:"file",clickFn:function(e,l){1<c.dialogs.length&&(f('[name="url"]',o).val(e),c.afterSelectFile&&c.afterSelectFile.call(c,e),c.hideDialog())}})})}):u.hide(),r.val(l),d.val(a),r[0].focus(),r[0].select()},c.clickToolbar(p,function(){c.plugin.fileDialog({clickFn:function(e,l){var a='<a class="ke-insertfile" href="'+e+'" data-ke-src="'+e+'" target="_blank">'+l+"</a>";c.insertHtml(a).hideDialog().focus()}})})});