KindEditor.plugin("filemanager",function(_){var b=this,w="filemanager",y=_.undef(b.fileManagerJson,b.basePath+"php/file_manager_json.php"),C=b.pluginsPath+w+"/images/",T=b.lang(w+".");function I(e,i){var a,n,l;i.is_dir?e.attr("title",i.filename):e.attr("title",(a=i.filename,n=i.filesize,l=i.datetime,a+" ("+Math.ceil(n/1024)+"KB, "+l+")"))}b.plugin.filemanagerDialog=function(e){var i=_.undef(e.width,650),a=_.undef(e.height,510),l=_.undef(e.dirName,""),n=_.undef(e.viewType,"VIEW").toUpperCase(),o=e.clickFn,t=['<div style="padding:10px 20px;">','<div class="ke-plugin-filemanager-header">','<div class="ke-left">','<img class="ke-inline-block" name="moveupImg" src="'+C+'go-up.gif" width="16" height="16" border="0" alt="" /> ','<a class="ke-inline-block" name="moveupLink" href="javascript:;">'+T.moveup+"</a>","</div>",'<div class="ke-right">',T.viewType+' <select class="ke-inline-block" name="viewType">','<option value="VIEW">'+T.viewImage+"</option>",'<option value="LIST">'+T.listImage+"</option>","</select> ",T.orderType+' <select class="ke-inline-block" name="orderType">','<option value="NAME">'+T.fileName+"</option>",'<option value="SIZE">'+T.fileSize+"</option>",'<option value="TYPE">'+T.fileType+"</option>","</select>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-plugin-filemanager-body"></div>',"</div>"].join(""),r=b.createDialog({name:w,width:i,height:a,title:b.lang(w),body:t}),d=r.div,c=_(".ke-plugin-filemanager-body",d),s=(_('[name="moveupImg"]',d),_('[name="moveupLink"]',d)),m=(_('[name="viewServer"]',d),_('[name="viewType"]',d)),p=_('[name="orderType"]',d);function f(e,i,a){var n="path="+e+"&order="+i+"&dir="+l;r.showLoading(b.lang("ajaxLoading")),_.ajax(_.addParam(y,n+"&"+(new Date).getTime()),function(e){r.hideLoading(),a(e)})}var u=[];function v(e,i,a,n){var l=_.formatUrl(i.current_url+a.filename,"absolute"),t=encodeURIComponent(i.current_dir_path+a.filename+"/");a.is_dir?e.click(function(e){f(t,p.val(),n)}):a.is_photo?e.click(function(e){o.call(this,l,a.filename)}):e.click(function(e){o.call(this,l,a.filename)}),u.push(e)}function h(i,a){function e(){"VIEW"==m.val()?f(i.current_dir_path,p.val(),k):f(i.current_dir_path,p.val(),g)}_.each(u,function(){this.unbind()}),s.unbind(),m.unbind(),p.unbind(),i.current_dir_path&&s.click(function(e){f(i.moveup_dir_path,p.val(),a)}),m.change(e),p.change(e),c.html("")}function g(e){h(e,g);var i=document.createElement("table");i.className="ke-table",i.cellPadding=0,i.cellSpacing=0,i.border=0,c.append(i);for(var a=e.file_list,n=0,l=a.length;n<l;n++){var t=a[n],o=_(i.insertRow(n));o.mouseover(function(e){_(this).addClass("ke-on")}).mouseout(function(e){_(this).removeClass("ke-on")});var r=C+(t.is_dir?"folder-16.gif":"file-16.gif"),d=_('<img src="'+r+'" width="16" height="16" alt="'+t.filename+'" align="absmiddle" />'),s=_(o[0].insertCell(0)).addClass("ke-cell ke-name").append(d).append(document.createTextNode(" "+t.filename));!t.is_dir||t.has_file?(o.css("cursor","pointer"),s.attr("title",t.filename),v(s,e,t,g)):s.attr("title",T.emptyFolder),_(o[0].insertCell(1)).addClass("ke-cell ke-size").html(t.is_dir?"-":Math.ceil(t.filesize/1024)+"KB"),_(o[0].insertCell(2)).addClass("ke-cell ke-datetime").html(t.datetime)}}function k(e){h(e,k);for(var i=e.file_list,a=0,n=i.length;a<n;a++){var l=i[a],t=_('<div class="ke-inline-block ke-item"></div>');c.append(t);var o=_('<div class="ke-inline-block ke-photo"></div>').mouseover(function(e){_(this).addClass("ke-on")}).mouseout(function(e){_(this).removeClass("ke-on")});t.append(o);var r=e.current_url+l.filename,d=l.is_dir?C+"folder-64.gif":l.is_photo?r:C+"file-64.gif",s=_('<img src="'+d+'" width="80" height="80" alt="'+l.filename+'" />');!l.is_dir||l.has_file?(o.css("cursor","pointer"),I(o,l),v(o,e,l,k)):o.attr("title",T.emptyFolder),o.append(s),t.append('<div class="ke-name" title="'+l.filename+'">'+l.filename+"</div>")}}return m.val(n),f("",p.val(),"VIEW"==n?k:g),r}});